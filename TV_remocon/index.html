<!DOCTYPE html>
<html>
<head>
    <title>Samsung TV Remote - API Deep Analysis</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container { 
            max-width: 600px; 
            margin: 0 auto; 
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 32px;
            margin-bottom: 5px;
        }
        
        .settings-box, .control-box {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .section-title {
            font-size: 14px;
            font-weight: 700;
            color: #333;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #666;
            margin-bottom: 8px;
            margin-top: 12px;
        }
        
        label:first-of-type { margin-top: 0; }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
            margin-bottom: 12px;
            font-family: inherit;
            box-sizing: border-box;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        textarea {
            resize: vertical;
            min-height: 150px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            overflow-y: auto;
        }
        
        .button-row {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .button-row button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .button-row button:active {
            transform: scale(0.95);
        }
        
        .save-btn {
            background-color: #4CAF50;
            color: white;
        }
        
        .save-btn:hover {
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }
        
        .test-btn {
            background-color: #2196F3;
            color: white;
        }
        
        .test-btn:hover {
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
        }
        
        .clear-btn {
            background-color: #f44336;
            color: white;
        }
        
        .clear-btn:hover {
            box-shadow: 0 5px 15px rgba(244, 67, 54, 0.3);
        }
        
        .status {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            display: none;
            font-size: 14px;
            font-weight: 600;
            animation: slideUp 0.3s ease-out;
            max-width: 560px;
            margin: 0 auto;
            z-index: 1000;
        }
        
        .status.show {
            display: block;
        }
        
        .status.success {
            background-color: #4CAF50;
            color: white;
        }
        
        .status.error {
            background-color: #f44336;
            color: white;
        }
        
        .status.info {
            background-color: #2196F3;
            color: white;
        }
        
        .api-response {
            background-color: #f5f5f5;
            border-left: 4px solid #2196F3;
            padding: 12px;
            margin-bottom: 12px;
            border-radius: 4px;
            font-size: 11px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .api-response.error {
            border-left-color: #f44336;
            background-color: #ffebee;
        }
        
        .api-response.success {
            border-left-color: #4CAF50;
            background-color: #e8f5e9;
        }
        
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Courier New', monospace;
            font-size: 11px;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“º SmartThings API Analysis</h1>
            <p>REST APIë¡œ TV ì•± ì •ë³´ ì¡°íšŒ</p>
        </div>

        <!-- ì„¤ì • ì„¹ì…˜ -->
        <div class="settings-box">
            <div class="section-title">âš™ï¸ API ì„¤ì •</div>
            
            <label>Personal Access Token</label>
            <input type="password" id="accessToken" placeholder="https://account.smartthings.com/tokens">

            <label>Device ID</label>
            <input type="text" id="deviceId" placeholder="TV Device ID">

            <div class="button-row">
                <button class="save-btn" onclick="saveSettings()">ì €ì¥</button>
                <button class="clear-btn" onclick="clearSettings()">ì´ˆê¸°í™”</button>
            </div>
        </div>

        <!-- API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸ -->
        <div class="control-box">
            <div class="section-title">ğŸ”— REST API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸</div>
            
            <p style="font-size: 12px; color: #666; margin-bottom: 15px;">
                âš ï¸ SmartThings APIëŠ” ì„¤ì¹˜ëœ ì•± ëª©ë¡ì„ ì§ì ‘ ë°˜í™˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ìŒ ì—”ë“œí¬ì¸íŠ¸ë¡œ TV ìƒíƒœë¥¼ ì¡°íšŒí•˜ê³  ë¶„ì„í•©ë‹ˆë‹¤.
            </p>
            
            <div class="button-row">
                <button class="test-btn" onclick="testDevicesList()">1ï¸âƒ£ /devices ì¡°íšŒ</button>
                <button class="test-btn" onclick="testDeviceDetail()">2ï¸âƒ£ /devices/{id} ì¡°íšŒ</button>
            </div>
            
            <div class="button-row">
                <button class="test-btn" onclick="testDeviceStatus()">3ï¸âƒ£ /status ì¡°íšŒ</button>
                <button class="test-btn" onclick="testComponents()">4ï¸âƒ£ Components ì¡°íšŒ</button>
            </div>
            
            <label style="margin-top: 20px;">API ì‘ë‹µ ê²°ê³¼</label>
            <div id="apiResponse" class="api-response">ì‘ë‹µì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>
        </div>

        <!-- ì„¤ì¹˜ ì•± ê°ì§€ ì‹œë®¬ë ˆì´ì…˜ -->
        <div class="control-box">
            <div class="section-title">ğŸ“± ì•± ID í…ŒìŠ¤íŠ¸</div>
            
            <label>í…ŒìŠ¤íŠ¸í•  ì•± ID (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
            <textarea id="appIdsToTest" placeholder="wavve,3201907018807,111299001912,3201910019365">wavve
3201907018807
111299001912
3201910019365
3201602006622
3201601007230
3201706022396
3201704003368
3201707016433</textarea>
            
            <div class="button-row">
                <button class="test-btn" onclick="testAppsSequentially()">ìˆœì°¨ í…ŒìŠ¤íŠ¸ ì‹œì‘</button>
                <button class="clear-btn" onclick="clearTestResults()">ê²°ê³¼ ì´ˆê¸°í™”</button>
            </div>
            
            <label>í…ŒìŠ¤íŠ¸ ê²°ê³¼</label>
            <textarea id="testResults" readonly style="background-color: #f9f9f9;"></textarea>
        </div>

        <!-- ì»¤ìŠ¤í…€ ëª…ë ¹ -->
        <div class="control-box">
            <div class="section-title">âš¡ ì»¤ìŠ¤í…€ API í˜¸ì¶œ</div>
            
            <label>ì—”ë“œí¬ì¸íŠ¸ (ì˜ˆ: /devices/{deviceId}/commands)</label>
            <input type="text" id="customEndpoint" placeholder="/devices/{deviceId}/commands">
            
            <label>HTTP ë©”ì„œë“œ</label>
            <select id="httpMethod">
                <option value="GET">GET</option>
                <option value="POST">POST</option>
                <option value="PUT">PUT</option>
                <option value="DELETE">DELETE</option>
            </select>
            
            <label>Request Body (JSON)</label>
            <textarea id="customBody" style="min-height: 100px;">{
  "commands": [{
    "capability": "custom.launchapp",
    "command": "launchApp",
    "arguments": ["wavve"]
  }]
}</textarea>
            
            <div class="button-row">
                <button class="test-btn" onclick="sendCustomRequest()">ì „ì†¡</button>
            </div>
        </div>

        <!-- ë””ë²„ê·¸ ì •ë³´ -->
        <div class="control-box">
            <div class="section-title">ğŸ”§ ë””ë²„ê·¸ ë¡œê·¸</div>
            <textarea id="debugLog" readonly style="background-color: #f9f9f9;"></textarea>
            <div class="button-row" style="margin-top: 10px;">
                <button class="clear-btn" onclick="clearDebugLog()">ë¡œê·¸ ì‚­ì œ</button>
            </div>
        </div>
    </div>

    <div class="status" id="status"></div>

    <script>
        const API_BASE = 'https://api.smartthings.com/v1';

        window.addEventListener('DOMContentLoaded', function() {
            loadSettings();
        });

        function saveSettings() {
            const token = document.getElementById('accessToken').value.trim();
            const deviceId = document.getElementById('deviceId').value.trim();
            
            if (!token || !deviceId) {
                showStatus('í† í°ê³¼ ë””ë°”ì´ìŠ¤IDë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            localStorage.setItem('smartthings_token', token);
            localStorage.setItem('smartthings_deviceid', deviceId);
            showStatus('âœ“ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            addDebugLog('ì„¤ì • ì €ì¥ë¨');
        }

        function loadSettings() {
            const token = localStorage.getItem('smartthings_token');
            const deviceId = localStorage.getItem('smartthings_deviceid');

            if (token) document.getElementById('accessToken').value = token;
            if (deviceId) document.getElementById('deviceId').value = deviceId;
        }

        function clearSettings() {
            if (confirm('ì €ì¥ëœ ì„¤ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('smartthings_token');
                localStorage.removeItem('smartthings_deviceid');
                document.getElementById('accessToken').value = '';
                document.getElementById('deviceId').value = '';
                showStatus('âœ“ ì„¤ì •ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            }
        }

        function getCredentials() {
            const token = document.getElementById('accessToken').value.trim();
            const deviceId = document.getElementById('deviceId').value.trim();
            
            if (!token || !deviceId) {
                showStatus('âš ï¸ í† í°ê³¼ ë””ë°”ì´ìŠ¤IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return null;
            }
            return { token, deviceId };
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = 'status show ' + type;
            setTimeout(() => {
                statusDiv.className = 'status';
            }, 3000);
        }

        function addDebugLog(message) {
            const debugLog = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString();
            debugLog.value += `[${timestamp}] ${message}\n`;
            debugLog.scrollTop = debugLog.scrollHeight;
        }

        function clearDebugLog() {
            document.getElementById('debugLog').value = '';
        }

        function displayApiResponse(data, isError = false) {
            const response = document.getElementById('apiResponse');
            response.className = 'api-response' + (isError ? ' error' : ' success');
            response.innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
        }

        function addTestResult(appId, success, message) {
            const results = document.getElementById('testResults');
            const timestamp = new Date().toLocaleTimeString();
            const status = success ? 'âœ“ ì„±ê³µ' : 'âœ— ì‹¤íŒ¨';
            results.value += `[${timestamp}] ${appId}: ${status} - ${message}\n`;
            results.scrollTop = results.scrollHeight;
        }

        function clearTestResults() {
            document.getElementById('testResults').value = '';
        }

        // 1. /devices ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
        function testDevicesList() {
            const creds = getCredentials();
            if (!creds) return;

            showStatus('ğŸ“¡ /devices ì¡°íšŒ ì¤‘...', 'info');
            addDebugLog('GET /devices ìš”ì²­');

            fetch(`${API_BASE}/devices`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${creds.token}`,
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                displayApiResponse(data);
                showStatus('âœ“ ë””ë°”ì´ìŠ¤ ëª©ë¡ ì¡°íšŒ ì™„ë£Œ', 'success');
                addDebugLog(`ë””ë°”ì´ìŠ¤ ${data.items?.length || 0}ê°œ ë°œê²¬`);
            })
            .catch(error => {
                displayApiResponse({ error: error.message }, true);
                showStatus('ì˜¤ë¥˜: ' + error.message, 'error');
                addDebugLog('âŒ ì˜¤ë¥˜: ' + error.message);
            });
        }

        // 2. /devices/{id} ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
        function testDeviceDetail() {
            const creds = getCredentials();
            if (!creds) return;

            showStatus('ğŸ“¡ /devices/{id} ì¡°íšŒ ì¤‘...', 'info');
            addDebugLog(`GET /devices/${creds.deviceId}`);

            fetch(`${API_BASE}/devices/${creds.deviceId}`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${creds.token}`,
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                displayApiResponse(data);
                showStatus('âœ“ ë””ë°”ì´ìŠ¤ ìƒì„¸ ì •ë³´ ì¡°íšŒ ì™„ë£Œ', 'success');
                addDebugLog('ë””ë°”ì´ìŠ¤ ìƒì„¸ì •ë³´ ì¡°íšŒ ì™„ë£Œ');
                
                // Components ë¶„ì„
                if (data.components) {
                    const caps = Object.keys(data.components.main?.capabilities || []);
                    addDebugLog(`ì§€ì› Capabilities: ${caps.join(', ')}`);
                }
            })
            .catch(error => {
                displayApiResponse({ error: error.message }, true);
                showStatus('ì˜¤ë¥˜: ' + error.message, 'error');
                addDebugLog('âŒ ì˜¤ë¥˜: ' + error.message);
            });
        }

        // 3. /status ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
        function testDeviceStatus() {
            const creds = getCredentials();
            if (!creds) return;

            showStatus('ğŸ“¡ /status ì¡°íšŒ ì¤‘...', 'info');
            addDebugLog(`GET /devices/${creds.deviceId}/status`);

            fetch(`${API_BASE}/devices/${creds.deviceId}/status`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${creds.token}`,
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                displayApiResponse(data);
                showStatus('âœ“ TV ìƒíƒœ ì¡°íšŒ ì™„ë£Œ', 'success');
                addDebugLog('TV ìƒíƒœ ì¡°íšŒ ì™„ë£Œ');
            })
            .catch(error => {
                displayApiResponse({ error: error.message }, true);
                showStatus('ì˜¤ë¥˜: ' + error.message, 'error');
                addDebugLog('âŒ ì˜¤ë¥˜: ' + error.message);
            });
        }

        // 4. Components ìƒì„¸ ì¡°íšŒ
        function testComponents() {
            const creds = getCredentials();
            if (!creds) return;

            showStatus('ğŸ“¡ Components ì¡°íšŒ ì¤‘...', 'info');
            addDebugLog('Components ë¶„ì„ ì‹œì‘');

            fetch(`${API_BASE}/devices/${creds.deviceId}/status`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${creds.token}`,
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                const analysis = {
                    timestamp: new Date().toISOString(),
                    components: data.components,
                    analysis: {
                        hasLaunchApp: data.components?.main?.custom?.launchapp ? true : false,
                        capabilities: Object.keys(data.components?.main || {})
                    }
                };
                displayApiResponse(analysis);
                showStatus('âœ“ Components ë¶„ì„ ì™„ë£Œ', 'success');
                addDebugLog('Components ë¶„ì„ ì™„ë£Œ');
            })
            .catch(error => {
                displayApiResponse({ error: error.message }, true);
                showStatus('ì˜¤ë¥˜: ' + error.message, 'error');
                addDebugLog('âŒ ì˜¤ë¥˜: ' + error.message);
            });
        }

        // ì•± ID ìˆœì°¨ í…ŒìŠ¤íŠ¸
        async function testAppsSequentially() {
            const creds = getCredentials();
            if (!creds) return;

            const appIdString = document.getElementById('appIdsToTest').value.trim();
            const appIds = appIdString.split('\n')
                .map(id => id.trim())
                .filter(id => id.length > 0);

            if (appIds.length === 0) {
                showStatus('í…ŒìŠ¤íŠ¸í•  ì•± IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            clearTestResults();
            showStatus(`${appIds.length}ê°œ ì•± í…ŒìŠ¤íŠ¸ ì‹œì‘...`, 'info');
            addDebugLog(`ì•± ìˆœì°¨ í…ŒìŠ¤íŠ¸ ì‹œì‘: ${appIds.length}ê°œ`);

            for (const appId of appIds) {
                await testAppWithDelay(creds, appId);
            }

            showStatus('âœ“ ëª¨ë“  í…ŒìŠ¤íŠ¸ ì™„ë£Œ', 'success');
            addDebugLog('ëª¨ë“  í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
        }

        function testAppWithDelay(creds, appId) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    testAppLaunch(creds, appId, resolve);
                }, 1000);
            });
        }

        function testAppLaunch(creds, appId, callback) {
            const url = `${API_BASE}/devices/${creds.deviceId}/commands`;
            const body = {
                commands: [{
                    component: "main",
                    capability: "custom.launchapp",
                    command: "launchApp",
                    arguments: [appId]
                }]
            };

            fetch(url, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${creds.token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(body)
            })
            .then(response => {
                if (response.ok) {
                    addTestResult(appId, true, 'ì•± ì‹¤í–‰ ëª…ë ¹ ì „ì†¡ë¨');
                    addDebugLog(`âœ“ ${appId}: ì„±ê³µ`);
                } else {
                    response.json().then(err => {
                        addTestResult(appId, false, err.message || 'ì‘ë‹µ ì˜¤ë¥˜');
                        addDebugLog(`âœ— ${appId}: ì‹¤íŒ¨ - ${err.message}`);
                    });
                }
                callback();
            })
            .catch(error => {
                addTestResult(appId, false, error.message);
                addDebugLog(`âœ— ${appId}: ${error.message}`);
                callback();
            });
        }

        // ì»¤ìŠ¤í…€ API ìš”ì²­
        function sendCustomRequest() {
            const creds = getCredentials();
            if (!creds) return;

            const endpoint = document.getElementById('customEndpoint').value.trim();
            const method = document.getElementById('httpMethod').value;
            const bodyText = document.getElementById('customBody').value.trim();

            if (!endpoint) {
                showStatus('ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            const url = `${API_BASE}${endpoint.replace('{deviceId}', creds.deviceId)}`;
            let body = null;

            try {
                if (bodyText && (method === 'POST' || method === 'PUT')) {
                    body = JSON.parse(bodyText);
                }
            } catch (e) {
                showStatus('Request Body JSON í˜•ì‹ ì˜¤ë¥˜: ' + e.message, 'error');
                return;
            }

            showStatus(`ğŸ“¡ ${method} ${endpoint} ìš”ì²­ ì¤‘...`, 'info');
            addDebugLog(`${method} ${url}`);

            const options = {
                method: method,
                headers: {
                    'Authorization': `Bearer ${creds.token}`,
                    'Content-Type': 'application/json'
                }
            };

            if (body) {
                options.body = JSON.stringify(body);
            }

            fetch(url, options)
            .then(response => response.json())
            .then(data => {
                displayApiResponse(data);
                showStatus('âœ“ ìš”ì²­ ì™„ë£Œ', 'success');
                addDebugLog('ì»¤ìŠ¤í…€ ìš”ì²­ ì™„ë£Œ');
            })
            .catch(error => {
                displayApiResponse({ error: error.message }, true);
                showStatus('ì˜¤ë¥˜: ' + error.message, 'error');
                addDebugLog('âŒ ì˜¤ë¥˜: ' + error.message);
            });
        }
    </script>
</body>
</html>
